<!DOCTYPE html><html><head><script type="text/javascript">
(function(){(function(){function e(a){this.t={};this.tick=function(a,c,b){this.t[a]=[void 0!=b?b:(new Date).getTime(),c];if(void 0==b)try{window.console.timeStamp("CSI/"+a)}catch(d){}};this.tick("start",null,a)}var a;window.performance&&(a=window.performance.timing);var f=a?new e(a.responseStart):new e;window.jstiming={Timer:e,load:f};if(a){var c=a.navigationStart,d=a.responseStart;0<c&&d>=c&&(window.jstiming.srt=d-c)}if(a){var b=window.jstiming.load;0<c&&d>=c&&(b.tick("_wtsrt",void 0,c),b.tick("wtsrt_","_wtsrt",
d),b.tick("tbsd_","wtsrt_"))}try{a=null,window.chrome&&window.chrome.csi&&(a=Math.floor(window.chrome.csi().pageT),b&&0<c&&(b.tick("_tbnd",void 0,window.chrome.csi().startE),b.tick("tbnd_","_tbnd",c))),null==a&&window.gtbExternal&&(a=window.gtbExternal.pageT()),null==a&&window.external&&(a=window.external.pageT,b&&0<c&&(b.tick("_tbnd",void 0,window.external.startE),b.tick("tbnd_","_tbnd",c))),a&&(window.jstiming.pt=a)}catch(g){}})();})()
</script><script type="text/javascript">var KX_timer = new window.jstiming.Timer(); KX_timer.name = 'published';</script><title>Go 1.2 encoding.TextMarshaler and TextUnmarshaler</title><link rel="shortcut icon" href="https://ssl.gstatic.com/docs/documents/images/kix-favicon6.ico"><style type="text/css">
      body {
        font-family: arial, sans, sans-serif;
        margin: 0;
      }

      iframe {
        border: 0;
        frameborder: 0;
        height: 100%;
        width: 100%;
      }

      #header, #footer {
        background: #f0f0f0;
        padding: 10px 10px;
      }

      #header {
        border-bottom: 1px #ccc solid;
      }

      #footer {
        border-top: 1px #ccc solid;
        border-bottom: 1px #ccc solid;
        font-size: 13;
      }

      #contents {
        margin: 6px;
      }

      .dash {
        padding: 0 6px;
      }
    </style></head><body><div id="header">Go 1.2 encoding.TextMarshaler and TextUnmarshaler</div><div id="contents"><style type="text/css">@import url('https://themes.googleusercontent.com/fonts/css?kit=lhDjYqiy3mZ0x6ROQEUoUw');ul.lst-kix_buf82lhly8og-1{list-style-type:none}ul.lst-kix_buf82lhly8og-2{list-style-type:none}.lst-kix_buf82lhly8og-0>li:before{content:"\0025cf  "}ol.lst-kix_ayjolugk8v00-2.start{counter-reset:lst-ctn-kix_ayjolugk8v00-2 0}ul.lst-kix_buf82lhly8og-0{list-style-type:none}ul.lst-kix_buf82lhly8og-5{list-style-type:none}ul.lst-kix_buf82lhly8og-6{list-style-type:none}ul.lst-kix_buf82lhly8og-3{list-style-type:none}ul.lst-kix_buf82lhly8og-4{list-style-type:none}ol.lst-kix_jpviufoinhnt-5.start{counter-reset:lst-ctn-kix_jpviufoinhnt-5 0}.lst-kix_jpviufoinhnt-0>li:before{content:"" counter(lst-ctn-kix_jpviufoinhnt-0,decimal) ". "}.lst-kix_j0wn3u4pn8au-1>li{counter-increment:lst-ctn-kix_j0wn3u4pn8au-1}ol.lst-kix_j0wn3u4pn8au-5.start{counter-reset:lst-ctn-kix_j0wn3u4pn8au-5 0}.lst-kix_jpviufoinhnt-7>li:before{content:"" counter(lst-ctn-kix_jpviufoinhnt-7,lower-latin) ". "}.lst-kix_j0wn3u4pn8au-4>li:before{content:"" counter(lst-ctn-kix_j0wn3u4pn8au-4,lower-latin) ". "}ol.lst-kix_jpviufoinhnt-2.start{counter-reset:lst-ctn-kix_jpviufoinhnt-2 0}.lst-kix_j0wn3u4pn8au-6>li{counter-increment:lst-ctn-kix_j0wn3u4pn8au-6}ol.lst-kix_jpviufoinhnt-0.start{counter-reset:lst-ctn-kix_jpviufoinhnt-0 0}.lst-kix_ayjolugk8v00-1>li:before{content:"" counter(lst-ctn-kix_ayjolugk8v00-1,lower-latin) ". "}.lst-kix_j0wn3u4pn8au-0>li:before{content:"" counter(lst-ctn-kix_j0wn3u4pn8au-0,decimal) ". "}ol.lst-kix_ayjolugk8v00-8.start{counter-reset:lst-ctn-kix_ayjolugk8v00-8 0}ol.lst-kix_jpviufoinhnt-6.start{counter-reset:lst-ctn-kix_jpviufoinhnt-6 0}.lst-kix_ayjolugk8v00-2>li{counter-increment:lst-ctn-kix_ayjolugk8v00-2}ol.lst-kix_j0wn3u4pn8au-0.start{counter-reset:lst-ctn-kix_j0wn3u4pn8au-0 0}.lst-kix_ayjolugk8v00-6>li:before{content:"" counter(lst-ctn-kix_ayjolugk8v00-6,decimal) ". "}.lst-kix_ayjolugk8v00-4>li{counter-increment:lst-ctn-kix_ayjolugk8v00-4}.lst-kix_jpviufoinhnt-8>li:before{content:"" counter(lst-ctn-kix_jpviufoinhnt-8,lower-roman) ". "}.lst-kix_j0wn3u4pn8au-5>li:before{content:"" counter(lst-ctn-kix_j0wn3u4pn8au-5,lower-roman) ". "}ol.lst-kix_jpviufoinhnt-8.start{counter-reset:lst-ctn-kix_jpviufoinhnt-8 0}.lst-kix_j0wn3u4pn8au-2>li:before{content:"" counter(lst-ctn-kix_j0wn3u4pn8au-2,lower-roman) ". "}ol.lst-kix_j0wn3u4pn8au-3.start{counter-reset:lst-ctn-kix_j0wn3u4pn8au-3 0}ol.lst-kix_jpviufoinhnt-3{list-style-type:none}.lst-kix_nv0szp7jppz7-1>li:before{content:"\0025cb  "}ol.lst-kix_jpviufoinhnt-4{list-style-type:none}ol.lst-kix_jpviufoinhnt-5{list-style-type:none}.lst-kix_j0wn3u4pn8au-4>li{counter-increment:lst-ctn-kix_j0wn3u4pn8au-4}ol.lst-kix_jpviufoinhnt-6{list-style-type:none}.lst-kix_buf82lhly8og-2>li:before{content:"\0025a0  "}ol.lst-kix_jpviufoinhnt-7{list-style-type:none}ol.lst-kix_jpviufoinhnt-8{list-style-type:none}.lst-kix_nv0szp7jppz7-2>li:before{content:"\0025a0  "}.lst-kix_j0wn3u4pn8au-0>li{counter-increment:lst-ctn-kix_j0wn3u4pn8au-0}.lst-kix_jpviufoinhnt-7>li{counter-increment:lst-ctn-kix_jpviufoinhnt-7}.lst-kix_j0wn3u4pn8au-2>li{counter-increment:lst-ctn-kix_j0wn3u4pn8au-2}ol.lst-kix_jpviufoinhnt-3.start{counter-reset:lst-ctn-kix_jpviufoinhnt-3 0}ol.lst-kix_jpviufoinhnt-7.start{counter-reset:lst-ctn-kix_jpviufoinhnt-7 0}.lst-kix_buf82lhly8og-8>li:before{content:"\0025a0  "}.lst-kix_jpviufoinhnt-2>li:before{content:"" counter(lst-ctn-kix_jpviufoinhnt-2,lower-roman) ". "}.lst-kix_j0wn3u4pn8au-3>li:before{content:"" counter(lst-ctn-kix_j0wn3u4pn8au-3,decimal) ". "}.lst-kix_jpviufoinhnt-6>li:before{content:"" counter(lst-ctn-kix_jpviufoinhnt-6,decimal) ". "}.lst-kix_jpviufoinhnt-1>li{counter-increment:lst-ctn-kix_jpviufoinhnt-1}.lst-kix_jpviufoinhnt-0>li{counter-increment:lst-ctn-kix_jpviufoinhnt-0}.lst-kix_ayjolugk8v00-5>li:before{content:"" counter(lst-ctn-kix_ayjolugk8v00-5,lower-roman) ". "}.lst-kix_ayjolugk8v00-4>li:before{content:"" counter(lst-ctn-kix_ayjolugk8v00-4,lower-latin) ". "}.lst-kix_j0wn3u4pn8au-7>li:before{content:"" counter(lst-ctn-kix_j0wn3u4pn8au-7,lower-latin) ". "}.lst-kix_buf82lhly8og-5>li:before{content:"\0025a0  "}ol.lst-kix_ayjolugk8v00-4.start{counter-reset:lst-ctn-kix_ayjolugk8v00-4 0}ul.lst-kix_ayjolugk8v00-0{list-style-type:none}.lst-kix_ayjolugk8v00-1>li{counter-increment:lst-ctn-kix_ayjolugk8v00-1}.lst-kix_nv0szp7jppz7-5>li:before{content:"\0025a0  "}ol.lst-kix_j0wn3u4pn8au-1.start{counter-reset:lst-ctn-kix_j0wn3u4pn8au-1 0}ol.lst-kix_ayjolugk8v00-4{list-style-type:none}ol.lst-kix_ayjolugk8v00-3{list-style-type:none}ol.lst-kix_ayjolugk8v00-6{list-style-type:none}ol.lst-kix_ayjolugk8v00-5{list-style-type:none}ol.lst-kix_jpviufoinhnt-4.start{counter-reset:lst-ctn-kix_jpviufoinhnt-4 0}ol.lst-kix_jpviufoinhnt-1.start{counter-reset:lst-ctn-kix_jpviufoinhnt-1 0}ol.lst-kix_ayjolugk8v00-2{list-style-type:none}ol.lst-kix_ayjolugk8v00-1{list-style-type:none}.lst-kix_ayjolugk8v00-3>li{counter-increment:lst-ctn-kix_ayjolugk8v00-3}ol.lst-kix_ayjolugk8v00-3.start{counter-reset:lst-ctn-kix_ayjolugk8v00-3 0}.lst-kix_ayjolugk8v00-0>li:before{content:"\0025cf  "}ol.lst-kix_ayjolugk8v00-6.start{counter-reset:lst-ctn-kix_ayjolugk8v00-6 0}ol.lst-kix_ayjolugk8v00-8{list-style-type:none}ol.lst-kix_ayjolugk8v00-7{list-style-type:none}.lst-kix_buf82lhly8og-4>li:before{content:"\0025cb  "}.lst-kix_jpviufoinhnt-1>li:before{content:"" counter(lst-ctn-kix_jpviufoinhnt-1,lower-latin) ". "}.lst-kix_jpviufoinhnt-4>li{counter-increment:lst-ctn-kix_jpviufoinhnt-4}.lst-kix_jpviufoinhnt-3>li:before{content:"" counter(lst-ctn-kix_jpviufoinhnt-3,decimal) ". "}.lst-kix_jpviufoinhnt-3>li{counter-increment:lst-ctn-kix_jpviufoinhnt-3}.lst-kix_j0wn3u4pn8au-6>li:before{content:"" counter(lst-ctn-kix_j0wn3u4pn8au-6,decimal) ". "}ol.lst-kix_j0wn3u4pn8au-7.start{counter-reset:lst-ctn-kix_j0wn3u4pn8au-7 0}.lst-kix_j0wn3u4pn8au-8>li:before{content:"" counter(lst-ctn-kix_j0wn3u4pn8au-8,lower-roman) ". "}.lst-kix_nv0szp7jppz7-0>li:before{content:"\0025cf  "}.lst-kix_jpviufoinhnt-4>li:before{content:"" counter(lst-ctn-kix_jpviufoinhnt-4,lower-latin) ". "}.lst-kix_nv0szp7jppz7-6>li:before{content:"\0025cf  "}ol.lst-kix_jpviufoinhnt-0{list-style-type:none}ol.lst-kix_jpviufoinhnt-1{list-style-type:none}ol.lst-kix_jpviufoinhnt-2{list-style-type:none}ul.lst-kix_nv0szp7jppz7-8{list-style-type:none}.lst-kix_nv0szp7jppz7-7>li:before{content:"\0025cb  "}ol.lst-kix_j0wn3u4pn8au-4.start{counter-reset:lst-ctn-kix_j0wn3u4pn8au-4 0}ul.lst-kix_nv0szp7jppz7-5{list-style-type:none}ul.lst-kix_nv0szp7jppz7-4{list-style-type:none}ul.lst-kix_nv0szp7jppz7-7{list-style-type:none}ul.lst-kix_nv0szp7jppz7-6{list-style-type:none}ul.lst-kix_nv0szp7jppz7-1{list-style-type:none}ul.lst-kix_nv0szp7jppz7-0{list-style-type:none}ul.lst-kix_nv0szp7jppz7-3{list-style-type:none}ul.lst-kix_nv0szp7jppz7-2{list-style-type:none}.lst-kix_jpviufoinhnt-8>li{counter-increment:lst-ctn-kix_jpviufoinhnt-8}.lst-kix_ayjolugk8v00-3>li:before{content:"" counter(lst-ctn-kix_ayjolugk8v00-3,decimal) ". "}.lst-kix_j0wn3u4pn8au-3>li{counter-increment:lst-ctn-kix_j0wn3u4pn8au-3}.lst-kix_ayjolugk8v00-5>li{counter-increment:lst-ctn-kix_ayjolugk8v00-5}.lst-kix_ayjolugk8v00-7>li{counter-increment:lst-ctn-kix_ayjolugk8v00-7}.lst-kix_buf82lhly8og-7>li:before{content:"\0025cb  "}.lst-kix_j0wn3u4pn8au-8>li{counter-increment:lst-ctn-kix_j0wn3u4pn8au-8}.lst-kix_jpviufoinhnt-2>li{counter-increment:lst-ctn-kix_jpviufoinhnt-2}.lst-kix_nv0szp7jppz7-3>li:before{content:"\0025cf  "}.lst-kix_buf82lhly8og-6>li:before{content:"\0025cf  "}.lst-kix_jpviufoinhnt-5>li:before{content:"" counter(lst-ctn-kix_jpviufoinhnt-5,lower-roman) ". "}.lst-kix_j0wn3u4pn8au-1>li:before{content:"" counter(lst-ctn-kix_j0wn3u4pn8au-1,lower-latin) ". "}.lst-kix_jpviufoinhnt-5>li{counter-increment:lst-ctn-kix_jpviufoinhnt-5}.lst-kix_nv0szp7jppz7-4>li:before{content:"\0025cb  "}ol.lst-kix_ayjolugk8v00-5.start{counter-reset:lst-ctn-kix_ayjolugk8v00-5 0}ol.lst-kix_j0wn3u4pn8au-2.start{counter-reset:lst-ctn-kix_j0wn3u4pn8au-2 0}.lst-kix_j0wn3u4pn8au-5>li{counter-increment:lst-ctn-kix_j0wn3u4pn8au-5}ol.lst-kix_ayjolugk8v00-7.start{counter-reset:lst-ctn-kix_ayjolugk8v00-7 0}.lst-kix_jpviufoinhnt-6>li{counter-increment:lst-ctn-kix_jpviufoinhnt-6}.lst-kix_ayjolugk8v00-8>li{counter-increment:lst-ctn-kix_ayjolugk8v00-8}.lst-kix_nv0szp7jppz7-8>li:before{content:"\0025a0  "}.lst-kix_ayjolugk8v00-7>li:before{content:"" counter(lst-ctn-kix_ayjolugk8v00-7,lower-latin) ". "}ol.lst-kix_j0wn3u4pn8au-7{list-style-type:none}ol.lst-kix_j0wn3u4pn8au-6{list-style-type:none}.lst-kix_buf82lhly8og-1>li:before{content:"\0025cb  "}.lst-kix_ayjolugk8v00-8>li:before{content:"" counter(lst-ctn-kix_ayjolugk8v00-8,lower-roman) ". "}.lst-kix_ayjolugk8v00-2>li:before{content:"" counter(lst-ctn-kix_ayjolugk8v00-2,lower-roman) ". "}ol.lst-kix_j0wn3u4pn8au-8{list-style-type:none}ul.lst-kix_buf82lhly8og-7{list-style-type:none}ul.lst-kix_buf82lhly8og-8{list-style-type:none}ol.lst-kix_ayjolugk8v00-1.start{counter-reset:lst-ctn-kix_ayjolugk8v00-1 0}ol.lst-kix_j0wn3u4pn8au-6.start{counter-reset:lst-ctn-kix_j0wn3u4pn8au-6 0}ol.lst-kix_j0wn3u4pn8au-8.start{counter-reset:lst-ctn-kix_j0wn3u4pn8au-8 0}ol.lst-kix_j0wn3u4pn8au-1{list-style-type:none}ol.lst-kix_j0wn3u4pn8au-0{list-style-type:none}ol.lst-kix_j0wn3u4pn8au-3{list-style-type:none}ol.lst-kix_j0wn3u4pn8au-2{list-style-type:none}.lst-kix_j0wn3u4pn8au-7>li{counter-increment:lst-ctn-kix_j0wn3u4pn8au-7}.lst-kix_buf82lhly8og-3>li:before{content:"\0025cf  "}.lst-kix_ayjolugk8v00-6>li{counter-increment:lst-ctn-kix_ayjolugk8v00-6}ol.lst-kix_j0wn3u4pn8au-5{list-style-type:none}ol.lst-kix_j0wn3u4pn8au-4{list-style-type:none}ol{margin:0;padding:0}.c0{height:11pt;text-align:left;direction:ltr}.c10{max-width:468pt;background-color:#ffffff;padding:72pt 72pt 72pt 72pt}.c9{color:#1155cc;text-decoration:underline}.c6{color:inherit;text-decoration:inherit}.c11{font-weight:bold}.c4{text-align:left}.c7{text-align:center}.c1{font-family:"Consolas"}.c2{direction:ltr}.c5{margin-left:36pt}.c3{height:11pt}.c8{font-size:6pt}.title{padding-top:0pt;line-height:1.15;text-align:left;color:#000000;font-size:11pt;font-family:"Arial";padding-bottom:0pt}.subtitle{padding-top:0pt;line-height:1.15;text-align:left;color:#000000;font-size:11pt;font-family:"Arial";padding-bottom:0pt}li{color:#000000;font-size:11pt;font-family:"Arial"}p{color:#000000;font-size:11pt;margin:0;font-family:"Arial"}h1{padding-top:0pt;line-height:1.15;text-align:left;color:#000000;font-size:18pt;font-family:"Arial";padding-bottom:0pt}h2{padding-top:0pt;line-height:1.15;text-align:left;color:#000000;font-size:14pt;font-family:"Arial";padding-bottom:0pt}h3{padding-top:0pt;line-height:1.15;text-align:left;color:#666666;font-size:12pt;font-family:"Arial";padding-bottom:0pt}h4{padding-top:0pt;line-height:1.15;text-align:left;color:#666666;font-style:italic;font-size:11pt;font-family:"Arial";padding-bottom:0pt}h5{padding-top:0pt;line-height:1.15;text-align:left;color:#666666;font-size:10pt;font-family:"Arial";padding-bottom:0pt}h6{padding-top:0pt;line-height:1.15;text-align:left;color:#666666;font-style:italic;font-size:11pt;font-family:"Arial";padding-bottom:0pt}</style><p class="c7 c2"><span class="c11">Go </span><span class="c11">1.2 encoding.TextMarshaler and TextUnmarshaler</span></p><p class="c2 c3"><span></span></p><p class="c7 c2"><span>Russ Cox</span></p><p class="c2 c7"><span>July 2013</span></p><p class="c0"><span></span></p><p class="c4 c2"><span class="c11">Abstract</span></p><p class="c0"><span></span></p><p class="c4 c2"><span>For Go 1.2, we propose to add a new package “encoding” defining interfaces recognized by multiple encoders. In the long term, the “encoding” package should be similar in scope to “io”: primarily interfaces, importing few other packages.</span></p><p class="c0"><span></span></p><p class="c2 c4"><span>The initial content of the package is two interfaces, TextMarshaler and TextUnmarshaler, implemented by objects that can convert to and from a UTF-8 text representation.</span></p><p class="c0"><span></span></p><p class="c4 c2"><span class="c9"><a class="c6" href="https://groups.google.com/d/topic/golang-dev/pXLNF6lH9WE/discussion">Discussion on golang-dev</a></span><span>.</span></p><p class="c0"><span></span></p><p class="c4 c2"><span class="c11">Background</span></p><p class="c0"><span></span></p><p class="c4 c2"><span>(A separate proposal defines </span><span class="c9"><a class="c6" href="https://docs.google.com/document/d/1G-AMeUPoyTnbZDkuCJA89DjJwTjdWFctIZ_N9NgA9RM/pub">Marshaler and Unmarshaler for encoding/xml</a></span><span>. Those interfaces cannot be implemented without importing “encoding/xml”).</span></p><p class="c0"><span></span></p><p class="c4 c2"><span>More generally, each time a new encoding is defined, the package defines its own Marshaler and Unmarshaler interfaces that must then be implemented by objects for which the default encoding is inappropriate. This process does not scale: time.Time already implements marshaling and unmarshaling methods for “encoding/gob” and “encoding/json”. Even if it could define methods for “encoding/xml” without the import problem, it is far from clear that we’d want to keep adding methods. We have also resisted adding marshaling and unmarshaling methods to other common types such as net.IP.</span></p><p class="c4 c2"><span><br>A common pair of interfaces agreed upon by many encoders provides a solution to both problems: the interfaces can be implemented without any required imports, and one pair of methods suffices to make types encodable in multiple encodings.</span></p><p class="c2 c3"><span></span></p><a href="go12encoding.html#" name="kix.iq2by6z6ng87"></a><p class="c2"><span class="c11">Proposal</span></p><p class="c2 c3"><span></span></p><p class="c2"><span>Define a new package, imported as “encoding”, that defines TextMarshaler and TextUnmarshaler interfaces:</span></p><p class="c2 c3"><span></span></p><p class="c2 c5"><span class="c1">// Package encoding defines interfaces understood</span></p><p class="c2 c5"><span class="c1">// by multiple encoders.</span></p><p class="c2 c5"><span class="c1">package encoding</span></p><p class="c2 c5 c3"><span class="c1 c8"></span></p><p class="c2 c5"><span class="c1">// A TextMarshaler is the interface implemented by</span></p><p class="c2 c5"><span class="c1">// an object that can marshal itself as UTF-8 text.</span></p><p class="c2 c5"><span class="c1">// The result must be valid UTF-8.</span></p><p class="c2 c5"><span class="c1">type TextMarshaler interface {</span></p><p class="c2 c5"><span class="c1">        MarshalText() (text []byte, error)</span></p><p class="c2 c5"><span class="c1">}</span></p><p class="c2 c5 c3"><span class="c1 c8"></span></p><p class="c2 c5"><span class="c1">// A TextUnmarshaler is the interface implemented by</span></p><p class="c2 c5"><span class="c1">// an object that can unmarshal a UTF-8 text description</span></p><p class="c2 c5"><span class="c1">// of itself.</span></p><p class="c2 c5"><span class="c1">type TextUnmarshaler interface {</span></p><p class="c2 c5"><span class="c1">        UnmarshalText(text []byte) error</span></p><p class="c2 c5"><span class="c1">}</span></p><p class="c2 c3"><span></span></p><p class="c2"><span>Then, change both “encoding/json” and “encoding/xml” to recognize these interfaces if an object does not implement the encoding-specific marshaler/unmarshaler methods. In JSON, the serialization is a string value; in XML, the serialization is either an XML attribute or an XML tag containing textual chardata, depending on the presence of the “,attr” field tag. </span></p><p class="c2 c3"><span></span></p><p class="c2"><span>In package “time”, define Time.MarshalText and (*Time).UnmarshalText, using the same RFC3339 encoding currently used for Time.MarshalJSON and (*Time).UnmarshalJSON.</span></p><p class="c2 c3"><span></span></p><p class="c2"><span>In package “net”, define IP.MarshalText and (*IP).UnmarshalText.</span></p><p class="c2 c3"><span></span></p><p class="c2"><span>For example, if IP.MarshalText returns the usual string form of an IP address, then the value net.IP{192, 168, 0, 10} will marshal as the text “</span><span class="c1">192.168.0.10</span><span>”, which the JSON encoder would frame as the JSON string value </span><span class="c1">&quot;192.168.0.10&quot;</span><span> and the XML encoder would frame as the XML element </span><span class="c1">&lt;IP&gt;192.168.0.10&lt;/IP&gt;</span><span>. (Or, if the struct field holding the IP address had the field tag `xml:”,attr”`, it would turn into an XML attribute on the outer element.)</span></p><p class="c2 c3"><span></span></p><p class="c2"><span class="c11">Discussion</span></p><p class="c2 c3"><span></span></p><p class="c2"><span>It is important to consider backwards compatibility of existing encodings, and having a TextMarshaler raises the question of having a BinaryMarshaler.</span></p><p class="c2 c3"><span></span></p><p class="c2"><span class="c11">time.Time</span></p><p class="c2"><span>Today, time.Time encodes to XML using a special case in “encoding/xml”. If we preserve the visible behavior, we can make time.Time encode using these interfaces and remove the special case from “encoding/xml”. Similarly, time.Time encodes to JSON using MarshalJSON and UnmarshalJSON methods. We cannot remove these methods during Go 1, but if we make MarshalText and UnmarshalText use the same text form currently used by JSON, we can remove the JSON-specific methods in Go 2. (We did plan ahead enough that “encoding/json” and “encoding/xml” use the same text encoding for times; otherwise these two constraints would be in conflict.)</span></p><p class="c2 c3"><span></span></p><p class="c2"><span class="c11">net.IP<br></span><span>Today, net.IP encodes to XML as if it were bytes of text, being coerced to UTF-8 in the process. So net.IP{192,168,0,10} encodes to the Go string &quot;\&quot;&lt;IP&gt;\xc0\xa8\uFFFD&amp;#xA;&lt;/IP&gt;\&quot;&quot;. The coercion of the NUL byte means that Unmarshal cannot reproduce the input. Equally bizarre, net.IP encodes to JSON as if it were binary data, which JSON turns into base64. So net.IP{192,168,0,10} encodes to the Go string &quot;\&quot;wKgACg==\&quot;&quot;. In the other direction, json.Unmarshal does refuse to unmarshal into a net.IP in Go 1 and Go 1.1. In all cases, the doc comments make no promise that named []byte types encode or decode at all. Because the current behavior is undocumented and nearly useless, we should change the behavior to produce useful output. Specifically, by defining the MarshalText and UnmarshalText methods on net.IP, we will end up with &lt;IP&gt;192.168.0.10&lt;/IP&gt; for XML and &quot;192.168.0.10&quot; for JSON.</span></p><p class="c2 c3"><span></span></p><p class="c2"><span>I am not sure if there are other common types we should be discussing. An argument could be made for the various net.TCPAddr, net.UDPAddr, and so on, but the counter-argument is that there are too many of them.</span></p><p class="c2 c3"><span></span></p><p class="c2"><span class="c11">BinaryMarshaler</span></p><p class="c2"><span>It may be appropriate to define BinaryMarshaler and BinaryUnmarshaler, either now or later. That could be used by “encoding/gob” and other binary encodings. Because there is only one possible use today (just gob), it does not seem worth doing </span><span>now</span><span>.</span></p><p class="c2 c3"><span></span></p><p class="c2"><span>The possibility of BinaryMarshaler is an argument for gob not to recognize TextMarshaler now. Eventually it would probably want to check for interfaces in the order gob.Marshaler, encoding.BinaryMarshaler, and encoding.TextMarshaler. It is only safe to add to the end of the preference list: BinaryMarshaler cannot be inserted in the middle if we add TextMarshaler now.</span></p><p class="c2 c3"><span></span></p><p class="c2"><span>Like we did for TextMarshaler, if time.Time’s BinaryMarshaler form matches the one it uses today in its gob-specific methods, we can drop the gob-specific methods in Go 2.</span></p><p class="c2 c3"><span class="c11"></span></p></div><div id="footer"><span>Published by <a target="_blank" title="Learn more about Google Drive" href="https://docs.google.com/">Google Drive</a></span><span class="dash">&ndash;</span><a href="https://docs.google.com/abuse?id=1u1a0ZxxBHWx5OCNNHXXR-yXl5ry5RM7DLlYy-5bjBE8">Report Abuse</a><span class="dash">&ndash;</span><span>Updated automatically every 5 minutes</span></div><script type="text/javascript">
(function(){if(window.jstiming){window.jstiming.a={};window.jstiming.b=1;var e=function(b,a,d){var c=b.t[a],g=b.t.start;if(c&&(g||d))return c=b.t[a][0],void 0!=d?g=d:g=g[0],c-g},n=function(b,a,d){var c="";window.jstiming.srt&&(c+="&srt="+window.jstiming.srt,delete window.jstiming.srt);window.jstiming.pt&&(c+="&tbsrt="+window.jstiming.pt,delete window.jstiming.pt);try{window.external&&window.external.tran?c+="&tran="+window.external.tran:window.gtbExternal&&window.gtbExternal.tran?c+="&tran="+window.gtbExternal.tran():
window.chrome&&window.chrome.csi&&(c+="&tran="+window.chrome.csi().tran)}catch(g){}var f=window.chrome;if(f&&(f=f.loadTimes)){f().wasFetchedViaSpdy&&(c+="&p=s");if(f().wasNpnNegotiated){var c=c+"&npn=1",k=f().npnNegotiatedProtocol;k&&(c+="&npnv="+(encodeURIComponent||escape)(k))}f().wasAlternateProtocolAvailable&&(c+="&apa=1")}var l=b.t,s=l.start,f=[],k=[],h;for(h in l)if("start"!=h&&0!=h.indexOf("_")){var m=l[h][1];m?l[m]&&k.push(h+"."+e(b,h,l[m][0])):s&&f.push(h+"."+e(b,h))}delete l.start;if(a)for(var p in a)c+=
"&"+p+"="+a[p];(a=d)||(a="https:"==document.location.protocol?"https://csi.gstatic.com/csi":"http://csi.gstatic.com/csi");return[a,"?v=3","&s="+(window.jstiming.sn||"_s")+"&action=",b.name,k.length?"&it="+k.join(","):"",c,"&rt=",f.join(",")].join("")};window.jstiming.getReportUri=n;var q=function(b,a,d){b=n(b,a,d);if(!b)return"";a=new Image;var c=window.jstiming.b++;window.jstiming.a[c]=a;a.onload=a.onerror=function(){window.jstiming&&delete window.jstiming.a[c]};a.src=b;a=null;return b};window.jstiming.report=
function(b,a,d){if("prerender"==document.webkitVisibilityState){var c=!1,g=function(){if(!c){a?a.prerender="1":a={prerender:"1"};var f;"prerender"==document.webkitVisibilityState?f=!1:(q(b,a,d),f=!0);f&&(c=!0,document.removeEventListener("webkitvisibilitychange",g,!1))}};document.addEventListener("webkitvisibilitychange",g,!1);return""}return q(b,a,d)};window.jstiming.reportDone=function(b){if(window.jstiming.b<=(b||1))return!1;for(var a in window.jstiming.a)return!1;return!0};var r=function(b,a,
d,c){return 0<d?(c?b.tick(a,c,d):b.tick(a,"",d),!0):!1};window.jstiming.getNavTiming=function(b){if(window.performance&&window.performance.timing){var a=window.performance.timing;r(b,"_dns",a.domainLookupStart)&&r(b,"dns_",a.domainLookupEnd,"_dns");r(b,"_con",a.connectStart)&&r(b,"con_",a.connectEnd,"_con");r(b,"_req",a.requestStart)&&r(b,"req_",a.responseStart,"_req");r(b,"_rcv",a.responseStart)&&r(b,"rcv_",a.responseEnd,"_rcv");if(r(b,"_ns",a.navigationStart)){r(b,"ntsrt_",a.responseStart,"_ns");
r(b,"nsfs_",a.fetchStart,"_ns");var d=window.external&&window.external.startE;!d&&window.chrome&&window.chrome.csi&&(d=Math.floor(window.chrome.csi().startE));d&&(r(b,"_se",d),r(b,"sens_",a.navigationStart,"_se"));r(b,"ntplt0_",a.loadEventStart,"_ns");r(b,"ntplt1_",a.loadEventEnd,"_ns")}}}};})()
</script><script type="text/javascript">KX_timer.tick('tl'); if (document.location.protocol == 'https:') {window.jstiming.report(KX_timer, undefined , 'https://gg.google.com/csi');} else {window.jstiming.report(KX_timer);}</script></body></html>